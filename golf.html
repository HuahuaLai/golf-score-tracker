<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高爾夫桿數紀錄器 (純本地版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        // 手動定義 Lucide React 圖示
        // 在純前端環境中，直接從 CDN 引入整個 Lucide React 庫較為複雜，
        // 因此我們只定義會用到的圖示。
        const ChevronLeft = (props) => (
            React.createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                React.createElement('path', { d: "m15 18-6-6 6-6" })
            )
        );
        const ChevronRight = (props) => (
            React.createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                React.createElement('path', { d: "m9 18 6-6-6-6" })
            )
        );
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // React 應用程式的程式碼從這裡開始
        const { useState, useEffect, useRef } = React;

        // 確認 Modal 組件 (用於清除紀錄)
        const ConfirmationModal = ({ message, onConfirm, onCancel }) => {
          return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
                <p className="text-lg font-semibold mb-6">{message}</p>
                <div className="flex justify-around gap-4">
                  <button
                    onClick={onConfirm}
                    className="bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-5 rounded-lg shadow-md
                               transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex-grow"
                  >
                    確認
                  </button>
                  <button
                    onClick={onCancel}
                    className="bg-gray-400 hover:bg-gray-500 text-gray-800 font-bold py-2 px-5 rounded-lg shadow-md
                               transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex-grow"
                  >
                    取消
                  </button>
                </div>
              </div>
            </div>
          );
        };

        // 主要 App 組件
        const App = () => {
          // 儲存18洞桿數的狀態，初始化為0
          const [holeScores, setHoleScores] = useState(Array(18).fill(0));
          // 追蹤目前球洞的狀態 (索引 0 到 17)
          const [currentHoleIndex, setCurrentHoleIndex] = useState(0);
          // 儲存總桿數的狀態
          const [totalScore, setTotalScore] = useState(0);
          // 確認清除 Modal 的可見性狀態
          const [showClearConfirm, setShowClearConfirm] = useState(false);
          // 最近更新球洞的暫時視覺回饋狀態
          const [lastUpdatedHole, setLastUpdatedHole] = useState(null);

          // 當 holeScores 改變時重新計算總桿數的 Effect
          useEffect(() => {
            const sum = holeScores.reduce((acc, score) => acc + score, 0);
            setTotalScore(sum);
          }, [holeScores]);

          // 處理數字按鈕點擊的函式
          const handleNumberClick = (num) => {
            const newScores = [...holeScores];
            newScores[currentHoleIndex] = num;
            setHoleScores(newScores);

            // 視覺回饋
            setLastUpdatedHole(currentHoleIndex);
            setTimeout(() => setLastUpdatedHole(null), 300); // 300ms 後移除高亮

            // 如果不是最後一洞，則移至下一洞
            if (currentHoleIndex < 17) {
              setCurrentHoleIndex(currentHoleIndex + 1);
            }
          };

          // 處理 +1 按鈕點擊的函式
          const handlePlusOne = () => {
            const newScores = [...holeScores];
            newScores[currentHoleIndex] = (newScores[currentHoleIndex] || 0) + 1; // 確保是數字
            setHoleScores(newScores);

            // 視覺回饋
            setLastUpdatedHole(currentHoleIndex);
            setTimeout(() => setLastUpdatedHole(null), 300);
          };

          // 處理 -1 按鈕點擊的函式
          const handleMinusOne = () => {
            const newScores = [...holeScores];
            newScores[currentHoleIndex] = newScores[currentHoleIndex] > 0 ? newScores[currentHoleIndex] - 1 : 0;
            setHoleScores(newScores);

            // 視覺回饋
            setLastUpdatedHole(currentHoleIndex);
            setTimeout(() => setLastUpdatedHole(null), 300);
          };

          // 初始化清除動作的函式 (顯示確認 Modal)
          const handleClearInitiate = () => {
            setShowClearConfirm(true);
          };

          // 確認清除動作的函式
          const handleClearConfirm = () => {
            setHoleScores(Array(18).fill(0));
            setCurrentHoleIndex(0); // 重設回第一洞
            setShowClearConfirm(false); // 隱藏 Modal
          };

          // 取消清除動作的函式
          const handleClearCancel = () => {
            setShowClearConfirm(false); // 隱藏 Modal
          };

          // 導覽至前一洞的函式
          const handlePrevHole = () => {
            setCurrentHoleIndex(prevIndex => Math.max(0, prevIndex - 1));
          };

          // 導覽至後一洞的函式
          const handleNextHole = () => {
            setCurrentHoleIndex(prevIndex => Math.min(17, prevIndex + 1));
          };

          // 顯示球洞格線的組件
          const HoleGrid = () => (
            <div className="grid grid-cols-10 gap-1 p-2 bg-neutral-200 rounded-lg shadow-inner w-full max-w-md mx-auto">
              {/* 1-9 洞的標頭列 */}
              {Array.from({ length: 9 }, (_, i) => i + 1).map(holeNum => (
                <div key={`header-${holeNum}`} className="text-center text-xs font-semibold text-neutral-600 p-1">
                  {holeNum}
                </div>
              ))}
              {/* 用於對齊的空格 */}
              <div className="col-span-1"></div>

              {/* 1-9 洞的分數 */}
              {holeScores.slice(0, 9).map((score, index) => (
                <div
                  key={`score-${index}`}
                  className={`col-span-1 flex items-center justify-center p-2 border border-neutral-300 rounded-md text-sm font-bold transition-all duration-150 ease-in-out cursor-pointer
                    ${index === currentHoleIndex ? 'bg-amber-200 border-amber-400 shadow-md ring-2 ring-amber-500' : 'bg-white hover:bg-neutral-50'}
                    ${index === lastUpdatedHole ? 'bg-emerald-200 border-emerald-400 animate-pulse' : ''}
                  `}
                  onClick={() => setCurrentHoleIndex(index)} // 允許點擊球洞以選擇
                >
                  {score === 0 ? '' : score}
                </div>
              ))}
              {/* 1-9 洞的總計 */}
              <div className="col-span-1 flex items-center justify-center p-2 border border-neutral-300 rounded-md bg-sky-100 text-sm font-bold">
                {holeScores.slice(0, 9).reduce((acc, s) => acc + s, 0)}
              </div>

              {/* 10-18 洞的標頭列 */}
              {Array.from({ length: 9 }, (_, i) => i + 10).map(holeNum => (
                <div key={`header-${holeNum}`} className="text-center text-xs font-semibold text-neutral-600 p-1">
                  {holeNum}
                </div>
              ))}
              {/* 用於對齊的空格 */}
              <div className="col-span-1"></div>

              {/* 10-18 洞的分數 */}
              {holeScores.slice(9, 18).map((score, index) => (
                <div
                  key={`score-${index + 9}`}
                  className={`col-span-1 flex items-center justify-center p-2 border border-neutral-300 rounded-md text-sm font-bold transition-all duration-150 ease-in-out cursor-pointer
                    ${(index + 9) === currentHoleIndex ? 'bg-amber-200 border-amber-400 shadow-md ring-2 ring-amber-500' : 'bg-white hover:bg-neutral-50'}
                    ${(index + 9) === lastUpdatedHole ? 'bg-emerald-200 border-emerald-400 animate-pulse' : ''}
                  `}
                  onClick={() => setCurrentHoleIndex(index + 9)} // 允許點擊球洞以選擇
                >
                  {score === 0 ? '' : score}
                </div>
              ))}
              {/* 10-18 洞的總計 */}
              <div className="col-span-1 flex items-center justify-center p-2 border border-neutral-300 rounded-md bg-sky-100 text-sm font-bold">
                {holeScores.slice(9, 18).reduce((acc, s) => acc + s, 0)}
              </div>
            </div>
          );

          // 數字輸入板 (1-15)
          const NumberInputPad = ({ handleNumberClick }) => (
            <div className="grid grid-cols-5 gap-2 p-4 bg-neutral-200 rounded-lg shadow-inner w-full max-w-md mx-auto mt-4">
              {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15].map(num => (
                <button
                  key={num}
                  onClick={() => handleNumberClick(num)}
                  className="bg-neutral-700 hover:bg-neutral-800 text-white font-bold py-3 sm:py-4 rounded-lg shadow-md text-lg sm:text-2xl
                             transition duration-200 ease-in-out transform hover:scale-105 active:scale-95"
                >
                  {num}
                </button>
              ))}
            </div>
          );

          // 導覽和調整按鈕組件
          const NavAdjustButtons = ({ handlePrevHole, handlePlusOne, handleMinusOne, handleNextHole }) => (
            <div className="flex justify-center items-center gap-2 p-2 w-full max-w-md mx-auto mt-2">
              <button
                onClick={handlePrevHole}
                disabled={currentHoleIndex === 0}
                className="bg-neutral-500 hover:bg-neutral-600 text-white font-bold py-3 px-4 rounded-lg shadow-md text-lg
                           transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex-grow disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <ChevronLeft size={24} />
              </button>
              <button
                onClick={handleMinusOne}
                className="bg-emerald-700 hover:bg-emerald-800 text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg
                           transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex-grow"
              >
                - 1
              </button>
              <button
                onClick={handlePlusOne}
                className="bg-red-700 hover:bg-red-800 text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg
                           transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex-grow"
              >
                + 1
              </button>
              <button
                onClick={handleNextHole}
                disabled={currentHoleIndex === 17}
                className="bg-neutral-500 hover:bg-neutral-600 text-white font-bold py-3 px-4 rounded-lg shadow-md text-lg
                           transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex-grow disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <ChevronRight size={24} />
              </button>
            </div>
          );

          return (
            <div className="min-h-screen bg-gradient-to-br from-neutral-100 to-neutral-300 flex flex-col items-center justify-start p-4 font-inter overflow-auto selection:bg-amber-500 selection:text-white">
              {/* 總桿數和目前球洞顯示 */}
              <div className="flex flex-col sm:flex-row justify-between items-center bg-neutral-700 text-white font-bold py-3 px-6 rounded-lg shadow-xl text-lg w-full max-w-md mx-auto mb-4 sticky top-4 z-10">
                <div className="flex items-center justify-center w-full sm:w-auto mb-2 sm:mb-0">
                  總桿數 <span className="ml-3 text-3xl font-mono">{totalScore}</span>
                </div>
                <div className="flex items-center justify-center w-full sm:w-auto">
                  目前球洞: <span className="ml-2 text-sky-300 text-3xl font-mono">{currentHoleIndex + 1}</span>
                </div>
              </div>

              <HoleGrid />
              <NumberInputPad handleNumberClick={handleNumberClick} />
              <NavAdjustButtons
                handlePrevHole={handlePrevHole}
                handlePlusOne={handlePlusOne}
                handleMinusOne={handleMinusOne}
                handleNextHole={handleNextHole}
              />

              <button
                onClick={handleClearInitiate}
                className="bg-red-700 hover:bg-red-800 text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg mt-4 w-full max-w-md
                           transition duration-200 ease-in-out transform hover:scale-105 active:scale-95"
              >
                清除所有紀錄
              </button>

              {/* 確認 Modal */}
              {showClearConfirm && (
                <ConfirmationModal
                  message="您確定要清除所有桿數嗎？此操作無法復原。"
                  onConfirm={handleClearConfirm}
                  onCancel={handleClearCancel}
                />
              )}
            </div>
          );
        };

        // 將 React 應用程式渲染到 HTML 頁面中的 'root' 元素
        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
        // React 應用程式的程式碼在這裡結束
    </script>
</body>
</html>
